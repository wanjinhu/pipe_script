getwd()
setwd("F:/Wanjin-Project/pipe_script/general/data/")
getwd()
library(tidyverse)
library(ggsci)
library(ggplot2)
df <- read.table("06_metaphlan_species.txt",
header = T,
sep = "\t",
check.names = F)
group <- read.table("group.txt",
header = T,
sep = "\t",
check.names = F)
col=pal_d3("category20")(20)
col2 = pal_d3("category20",alpha = 0.5)(20)
mypal=c(col,col2)
composition <- function(tax_lev) {
"
@功能: 对格式为<06_metaphlan_species.txt>的物种表做柱状组成图
@参数tax_lev: 在哪个水平做组成分析
"
split_data <- strsplit(df$clade_name, ";")
split_data <- do.call("rbind",split_data)
cols <- df[, c(2:ncol(df))]
df_merge <- do.call("cbind", list(split_data,cols))
names(df_merge)[1:7] <- c("kindom","phylum","class","order","family","genus","species")
spe <- df_merge[-c(1:7)]
tax <- df_merge[1:7]
phy <- spe %>%
group_by(tax$`tax_lev`) %>% # 使用tax中的X水平进行分类
summarise_all(sum) %>%
rename(`tax_lev` = `tax$tax_lev`) %>%
gather(key="samples",value = "abun",-`tax_lev`) %>% # 数据形式转换：“宽”转“长”
left_join(group,by=c("samples"="sample"))
p1 <-
ggplot(phy,aes(samples,abun,fill=`tax_lev`)) +
geom_bar(stat = "identity",position = "fill") +
facet_grid(. ~ group, scales = "free", space = "free_x") +
labs(x="",y="Percent")+
scale_fill_manual(values = mypal)+labs(fill="")+
theme_bw()+
theme(legend.title = element_blank(),
axis.text.x = element_text(angle = 45, hjust = 1, color = "black"))+
scale_y_continuous(expand=c(0,0))
return(p1)
}
p1 <- composition(tax_lev = "phylum")
split_data <- strsplit(df$clade_name, ";")
split_data <- do.call("rbind",split_data)
cols <- df[, c(2:ncol(df))]
df_merge <- do.call("cbind", list(split_data,cols))
names(df_merge)[1:7] <- c("kindom","phylum","class","order","family","genus","species")
spe <- df_merge[-c(1:7)]
tax <- df_merge[1:7]
View(spe)
View(tax)
test <- spe %>% group_by(tax$phylum) %>% summarise_all(sum)
View(test)
?rename
phy <- spe %>%
group_by(tax$`tax_lev`) %>% # 使用tax中的X水平进行分类
summarise_all(sum) %>%
rename_at(1, ~tax_lev) %>%
gather(key="samples",value = "abun",-`tax_lev`) %>% # 数据形式转换：“宽”转“长”
left_join(group,by=c("samples"="sample"))
tax_lev <- "phylum"
phy <- spe %>%
group_by(tax$`tax_lev`) %>% # 使用tax中的X水平进行分类
summarise_all(sum) %>%
rename_at(1, ~tax_lev) %>%
gather(key="samples",value = "abun",-`tax_lev`) %>% # 数据形式转换：“宽”转“长”
left_join(group,by=c("samples"="sample"))
View(phy)
test <- spe %>% group_by(tax$phylum) %>% summarise_all(sum) %>% rename_at(1,~"phylum")
View(test)
test <- spe %>% group_by(tax$phylum) %>% summarise_all(sum) %>% rename_at(1,~ "phylum")
test <- spe %>% group_by(tax$phylum) %>% summarise_all(sum) %>% rename_at(1,~ "phylum") %>% gather(key="samples",value = "abun",- "phylum")
View(test)
test <- spe %>% group_by(tax$phylum) %>% summarise_all(sum) %>% rename_at(1,~ "phylum") %>% gather(key="samples",value = "abun",- "phylum") %>% left_join(group,by=c("samples"="sample"))
View(test)
tax_lev
phy <- spe %>%
group_by(tax$`tax_lev`) %>% # 使用tax中的X水平进行分类
summarise_all(sum) %>%
rename_at(1, ~ tax_lev) %>%
gather(key="samples",value = "abun",- tax_lev) %>% # 数据形式转换：“宽”转“长”
left_join(group,by=c("samples"="sample"))
View(phy)
View(spe)
phy <- spe %>%
group_by(tax$`tax_lev`) %>% # 使用tax中的X水平进行分类
summarise_all(sum) %>%
rename_at(1, ~ tax_lev)
View(phy)
phy <- spe %>%
group_by(tax$`tax_lev`)
View(phy)
test <- spe %>% group_by(tax$phylum)
View(test)
View(spe)
phy <- spe %>% group_by(tax$`tax_lev`)
View(phy)
View(tax)
View(spe)
View(tax)
test <- spe %>% group_by(tax$phylum)
tagret <- tax$`tax_lev`
tagret <- tax$tax_lev
tax_lev
View(tax)
phy <- spe %>%
group_by(tax[[tax_lev]])
View(phy)
head(df)[1:2]
phy <- spe %>%
group_by(tax[[tax_lev]]) %>% # 使用tax中的X水平进行分类
summarise_all(sum)
View(phy)
phy <- spe %>%
group_by(tax[[tax_lev]]) %>% # 使用tax中的X水平进行分类
summarise_all(sum) %>%
rename_at(1, ~ tax_lev) %>%
gather(key="samples",value = "abun",- tax_lev) %>% # 数据形式转换：“宽”转“长”
left_join(group,by=c("samples"="sample"))
View(phy)
p1 <-
ggplot(phy,aes(samples,abun,fill=`tax_lev`)) +
geom_bar(stat = "identity",position = "fill") +
facet_grid(. ~ group, scales = "free", space = "free_x") +
labs(x="",y="Percent")+
scale_fill_manual(values = mypal)+labs(fill="")+
theme_bw()+
theme(legend.title = element_blank(),
axis.text.x = element_text(angle = 45, hjust = 1, color = "black"))+
scale_y_continuous(expand=c(0,0))
p1
View(phy)
p1 <-
ggplot(phy,aes(samples,abun,fill=tax_lev)) +
geom_bar(stat = "identity",position = "fill") +
facet_grid(. ~ group, scales = "free", space = "free_x") +
labs(x="",y="Percent")+
scale_fill_manual(values = mypal)+labs(fill="")+
theme_bw()+
theme(legend.title = element_blank(),
axis.text.x = element_text(angle = 45, hjust = 1, color = "black"))+
scale_y_continuous(expand=c(0,0))
p1
p1 <-
ggplot(phy,aes(samples,abun,fill=phy[[tax_lev]])) +
geom_bar(stat = "identity",position = "fill") +
facet_grid(. ~ group, scales = "free", space = "free_x") +
labs(x="",y="Percent")+
scale_fill_manual(values = mypal)+labs(fill="")+
theme_bw()+
theme(legend.title = element_blank(),
axis.text.x = element_text(angle = 45, hjust = 1, color = "black"))+
scale_y_continuous(expand=c(0,0))
p1
p1 <-
ggplot(phy,aes(samples,abun,fill=phy[[tax_lev]])) +
geom_bar(stat = "identity",position = "fill") +
facet_grid(. ~ group, scales = "free", space = "free_x") +
labs(x="",y="Percent")+
scale_fill_manual(values = mypal)+labs(fill="")+
theme_bw()+
theme(legend.title = element_blank(),
axis.text.x = element_text(angle = 45, hjust = 1, color = "black"))
p1
p1 <-
ggplot(phy,aes(samples,abun,fill=phy[[tax_lev]])) +
geom_bar(stat = "identity",position = "fill")
p1
p1 <-
ggplot(phy,aes(samples,abun,fill=phy[[tax_lev]])) +
geom_bar(stat = "identity",position = "fill") +
facet_grid(. ~ group, scales = "free", space = "free_x") +
labs(x="",y="Percent")+
scale_fill_manual(values = mypal)+labs(fill="")+
theme_bw()+
theme(legend.title = element_blank(),
axis.text.x = element_text(angle = 45, hjust = 1, color = "black"))+
scale_y_continuous(expand=c(0,0))
p1
p1 <-
ggplot(phy,aes(samples,abun,fill=.data[[tax_lev]])) +
geom_bar(stat = "identity",position = "fill") +
facet_grid(. ~ group, scales = "free", space = "free_x") +
labs(x="",y="Percent")+
scale_fill_manual(values = mypal)+labs(fill="")+
theme_bw()+
theme(legend.title = element_blank(),
axis.text.x = element_text(angle = 45, hjust = 1, color = "black"))+
scale_y_continuous(expand=c(0,0))
p1
library(scales)
show_col(col)
show_col(col2)
knitr::opts_chunk$set(echo = TRUE)
summary(cars)
plot(pressure)
plot(pressure)
knitr::opts_chunk$set(echo = TRUE)
library(scales)
library(ggsci)
colors_2<-c("#156077","#f46f20")
show_col(colors_2)
colors_2_1 <- c("#156077","#f46f20")
show_col(colors_2_1)
colors_2_2 <- c("#4da0a0","#9b3a74")
show_col(colors_2_2)
colors_3_1 <- c("#e20612","#ffd401","#00b0eb")
show_col(colors_3_1)
colors_5_1 <- c("#ef1828","#f88421","#ffbc14","#00bdcd","#006b7b")
show_col(colors_5_1)
colors_6_1 <- c("#3cb346","#00abf0","#d75427","#2e409a","#942d8d","#eeb401")
show_col(colors_6_1)
colors_8_1 <- c("#cc340c","#e8490f","#f18800","#e4ce00","#9ec417","#13a983","#44c1f0","#3f60aa")
show_col(colors_8_1)
colors_lancet <- pal_lancet("lanonc",alpha = 1)(10)
show_col(colors_lancet)
# 柳叶刀配色只有9种
colors_lancet <- pal_lancet("lanonc",alpha = 1)(9)
show_col(colors_lancet)
?pal_npg
colors_npg <- pal_npg("nrc",alpha = 1)(10)
show_col(colors_npg)
?pal_d3
colors_d3 <- pal_d3("category10",alpha = 1)(20)
show_col(colors_d3)
colors_d3_10 <- pal_d3("category10",alpha = 1)(10)
show_col(colors_d3_10)
colors_d3_10 <- pal_d3("category10",alpha = 1)(10)
show_col(colors_d3_10)
colors_d3_20_1 <- pal_d3("category20",alpha = 1)(20)
show_col(colors_d3_20_1)
colors_d3_10 <- pal_d3("category10",alpha = 1)(10)
show_col(colors_d3_10)
colors_d3_20_1 <- pal_d3("category20",alpha = 1)(20)
show_col(colors_d3_20_1)
?pal_igv
colors_igv <- pal_igv("default",alpha = 1)(51)
show_col(colors_igv)
View(phy)
colors_d3_10 <- pal_d3("category10",alpha = 1)(10)
show_col(colors_d3_10)
colors_d3_20 <- pal_d3("category20",alpha = 1)(20)
show_col(colors_d3_20)
